# <!-- Powered by BMAD™ Core -->
template:
  id: brownfield-prd-template-v2
  name: 브라운필드 개선 PRD
  version: 2.0
  output:
    format: markdown
    filename: docs/prd.md
    title: "{{project_name}} 브라운필드 개선 PRD"

workflow:
  mode: interactive
  elicitation: advanced-elicitation

sections:
  - id: intro-analysis
    title: 프로젝트 분석 및 맥락 소개
    instruction: |
      중요 - 범위 평가 필요:

      이 PRD는 포괄적인 계획과 여러 스토리가 필요한 기존 프로젝트의 중요한 개선을 위한 것입니다. 진행하기 전에:

      1. **개선 복잡성 평가**: 1-2번의 집중적인 개발 세션으로 완료할 수 있는 단순한 기능 추가나 버그 수정인 경우, 중단하고 다음을 권장하세요: "단순한 변경의 경우 제품 소유자와 함께 brownfield-create-epic 또는 brownfield-create-story 작업을 사용하는 것을 고려하세요. 이 전체 PRD 프로세스는 아키텍처 계획과 여러 조정된 스토리가 필요한 실질적인 개선을 위해 설계되었습니다."

      2. **프로젝트 맥락**: 프로젝트가 이미 로드된 IDE에서 작업하고 있는지 또는 사용자가 프로젝트 정보를 제공해야 하는지 결정하세요. 프로젝트 파일이 사용 가능한 경우 docs 폴더의 기존 문서를 분석하세요. 문서가 불충분한 경우 먼저 document-project 작업을 실행할 것을 권장하세요.

      3. **심층 평가 요구사항**: 제안을 하기 전에 기존 프로젝트 구조, 패턴, 제약사항을 철저히 분석해야 합니다. 모든 권장사항은 가정이 아닌 실제 프로젝트 분석에 근거해야 합니다.

      기존 프로젝트에 대한 포괄적인 정보를 수집하세요. 이 섹션은 요구사항을 진행하기 전에 완료되어야 합니다.

      중요: 이 분석 전반에 걸쳐 사용자와 이해를 명시적으로 확인하세요. 기존 프로젝트에 대한 모든 가정에 대해 다음과 같이 문의하세요: "분석을 바탕으로 [가정]이라고 이해합니다. 이것이 맞습니까?"

      사용자가 기존 시스템에 대한 이해를 검증하기 전까지는 권장사항을 진행하지 마세요.
    sections:
      - id: existing-project-overview
        title: 기존 프로젝트 개요
        instruction: document-project 분석이 이미 수행되었는지 확인하세요. 그렇다면 재분석 대신 해당 출력을 참조하세요.
        sections:
          - id: analysis-source
            title: 분석 소스
            instruction: |
              다음 중 하나를 표시하세요:
              - 사용 가능한 document-project 출력: {{path}}
              - IDE 기반 신규 분석
              - 사용자 제공 정보
          - id: current-state
            title: 현재 프로젝트 상태
            instruction: |
              - document-project 출력이 존재하는 경우: "고수준 아키텍처" 및 "기술 요약" 섹션에서 요약을 추출
              - 그렇지 않은 경우: 프로젝트가 현재 수행하는 작업과 주요 목적에 대한 간략한 설명
      - id: documentation-analysis
        title: 사용 가능한 문서 분석
        instruction: |
          document-project가 실행된 경우:
          - 참고: "Document-project 분석 사용 가능 - 기존 기술 문서 사용"
          - document-project에서 생성된 주요 문서 나열
          - 아래의 누락된 문서 확인 건너뛰기

          그렇지 않은 경우, 기존 문서 확인:
        sections:
          - id: available-docs
            title: 사용 가능한 문서
            type: checklist
            items:
              - 기술 스택 문서 [[LLM: document-project에서 생성된 경우 ✓ 체크]]
              - 소스 트리/아키텍처 [[LLM: document-project에서 생성된 경우 ✓ 체크]]
              - 코딩 표준 [[LLM: document-project에서 부분적일 수 있음]]
              - API 문서 [[LLM: document-project에서 생성된 경우 ✓ 체크]]
              - 외부 API 문서 [[LLM: document-project에서 생성된 경우 ✓ 체크]]
              - UX/UI 가이드라인 [[LLM: document-project에 없을 수 있음]]
              - 기술 부채 문서 [[LLM: document-project에서 생성된 경우 ✓ 체크]]
              - "기타: {{other_docs}}"
            instruction: |
              - document-project가 이미 실행된 경우: "document-project 출력에서 기존 프로젝트 분석 사용."
              - 중요한 문서가 누락되고 document-project가 없는 경우: "먼저 document-project 작업을 실행할 것을 권장합니다..."
      - id: enhancement-scope
        title: 개선 범위 정의
        instruction: 사용자와 함께 작업하여 어떤 유형의 개선인지 명확히 정의하세요. 이는 범위와 접근 방식에 중요합니다.
        sections:
          - id: enhancement-type
            title: 개선 유형
            type: checklist
            instruction: 사용자와 함께 해당하는 것을 결정
            items:
              - 새로운 기능 추가
              - 주요 기능 수정
              - 새로운 시스템과의 통합
              - 성능/확장성 개선
              - UI/UX 전면 개편
              - 기술 스택 업그레이드
              - 버그 수정 및 안정성 개선
              - "기타: {{other_type}}"
          - id: enhancement-description
            title: 개선 설명
            instruction: 사용자가 추가하거나 변경하고자 하는 것을 2-3문장으로 설명
          - id: impact-assessment
            title: 영향 평가
            type: checklist
            instruction: 기존 코드베이스에 대한 영향 범위 평가
            items:
              - 최소 영향 (격리된 추가사항)
              - 중간 영향 (일부 기존 코드 변경)
              - 상당한 영향 (실질적인 기존 코드 변경)
              - 주요 영향 (아키텍처 변경 필요)
      - id: goals-context
        title: 목표 및 배경 맥락
        sections:
          - id: goals
            title: 목표
            type: bullet-list
            instruction: 이 개선이 성공적으로 완료될 경우 제공할 한 줄짜리 원하는 결과의 항목 목록
          - id: background
            title: 배경 맥락
            type: paragraphs
            instruction: 이 개선이 왜 필요한지, 어떤 문제를 해결하는지, 기존 프로젝트와 어떻게 맞는지 설명하는 1-2개의 짧은 단락
      - id: changelog
        title: 변경 로그
        type: table
        columns: [변경, 날짜, 버전, 설명, 작성자]

  - id: requirements
    title: 요구사항
    instruction: |
      기존 프로젝트에 대한 검증된 이해를 바탕으로 기능적 및 비기능적 요구사항을 작성하세요. 요구사항을 제시하기 전에 다음을 확인하세요: "이러한 요구사항은 기존 시스템에 대한 제 이해를 바탕으로 합니다. 신중히 검토하고 프로젝트의 현실과 일치하는지 확인해 주세요."
    elicit: true
    sections:
      - id: functional
        title: 기능적
        type: numbered-list
        prefix: FR
        instruction: 각 요구사항은 FR로 시작하는 식별자를 가진 마크다운 항목이 됩니다
        examples:
          - "FR1: 기존 할 일 목록은 현재 기능을 손상시키지 않고 새로운 AI 중복 감지 서비스와 통합됩니다."
      - id: non-functional
        title: 비기능적
        type: numbered-list
        prefix: NFR
        instruction: 각 요구사항은 NFR로 시작하는 식별자를 가진 마크다운 항목이 됩니다. 기존 시스템의 제약사항을 포함하세요
        examples:
          - "NFR1: 개선사항은 기존 성능 특성을 유지해야 하며 현재 메모리 사용량을 20% 이상 초과하지 않아야 합니다."
      - id: compatibility
        title: 호환성 요구사항
        instruction: 브라운필드에 중요함 - 호환성을 유지해야 하는 것
        type: numbered-list
        prefix: CR
        template: "{{requirement}}: {{description}}"
        items:
          - id: cr1
            template: "CR1: {{existing_api_compatibility}}"
          - id: cr2
            template: "CR2: {{database_schema_compatibility}}"
          - id: cr3
            template: "CR3: {{ui_ux_consistency}}"
          - id: cr4
            template: "CR4: {{integration_compatibility}}"

  - id: ui-enhancement-goals
    title: 사용자 인터페이스 개선 목표
    condition: Enhancement includes UI changes
    instruction: UI 변경의 경우, 기존 UI 패턴 및 디자인 시스템과 어떻게 통합될지 파악하세요
    sections:
      - id: existing-ui-integration
        title: 기존 UI와의 통합
        instruction: 새로운 UI 요소가 기존 디자인 패턴, 스타일 가이드 및 컴포넌트 라이브러리와 어떻게 맞는지 설명
      - id: modified-screens
        title: 수정/새로운 화면 및 뷰
        instruction: 수정되거나 추가될 화면/뷰만 나열
      - id: ui-consistency
        title: UI 일관성 요구사항
        instruction: 기존 애플리케이션과 시각적 및 상호작용 일관성을 유지하기 위한 구체적 요구사항

  - id: technical-constraints
    title: 기술적 제약사항 및 통합 요구사항
    instruction: 이 섹션은 별도의 아키텍처 문서를 대체합니다. 기존 프로젝트 분석에서 상세한 기술적 제약사항을 수집하세요.
    sections:
      - id: existing-tech-stack
        title: 기존 기술 스택
        instruction: |
          document-project 출력이 사용 가능한 경우:
          - 고수준 아키텍처 섹션의 "실제 기술 스택" 테이블에서 추출
          - 버전 번호와 기록된 제약사항 포함

          그렇지 않은 경우, 현재 기술 스택을 문서화:
        template: |
          **언어**: {{languages}}
          **프레임워크**: {{frameworks}}
          **데이터베이스**: {{database}}
          **인프라**: {{infrastructure}}
          **외부 의존성**: {{external_dependencies}}
      - id: integration-approach
        title: 통합 접근 방식
        instruction: 개선사항이 기존 아키텍처와 어떻게 통합될지 정의
        template: |
          **데이터베이스 통합 전략**: {{database_integration}}
          **API 통합 전략**: {{api_integration}}
          **프론트엔드 통합 전략**: {{frontend_integration}}
          **테스팅 통합 전략**: {{testing_integration}}
      - id: code-organization
        title: 코드 조직 및 표준
        instruction: 기존 프로젝트 분석을 바탕으로 새로운 코드가 기존 패턴에 어떻게 맞을지 정의
        template: |
          **파일 구조 접근 방식**: {{file_structure}}
          **명명 규칙**: {{naming_conventions}}
          **코딩 표준**: {{coding_standards}}
          **문서화 표준**: {{documentation_standards}}
      - id: deployment-operations
        title: 배포 및 운영
        instruction: 개선사항이 기존 배포 파이프라인에 어떻게 맞는지
        template: |
          **빌드 프로세스 통합**: {{build_integration}}
          **배포 전략**: {{deployment_strategy}}
          **모니터링 및 로깅**: {{monitoring_logging}}
          **구성 관리**: {{config_management}}
      - id: risk-assessment
        title: 위험 평가 및 완화
        instruction: |
          document-project 출력이 사용 가능한 경우:
          - "기술 부채 및 알려진 이슈" 섹션 참조
          - 개선에 영향을 줄 수 있는 "해결책 및 주의사항" 포함
          - "중요한 기술 부채"에서 식별된 제약사항 기록

          기존 알려진 이슈를 포함한 위험 평가 구축:
        template: |
          **기술적 위험**: {{technical_risks}}
          **통합 위험**: {{integration_risks}}
          **배포 위험**: {{deployment_risks}}
          **완화 전략**: {{mitigation_strategies}}

  - id: epic-structure
    title: 에픽 및 스토리 구조
    instruction: |
      브라운필드 프로젝트의 경우, 사용자가 명확히 여러 관련 없는 개선사항을 요청하지 않는 한 단일 포괄적 에픽을 선호하세요. 에픽 구조를 제시하기 전에 다음을 확인하세요: "기존 프로젝트 분석을 바탕으로 이 개선사항은 [실제 프로젝트 분석을 기반으로 한 근거] 때문에 [단일 에픽/다중 에픽]으로 구조화되어야 한다고 생각합니다. 이것이 필요한 작업에 대한 귀하의 이해와 일치합니까?"
    elicit: true
    sections:
      - id: epic-approach
        title: 에픽 접근 방식
        instruction: 에픽 구조의 근거 설명 - 일반적으로 관련 없는 여러 기능이 아닌 이상 브라운필드에는 단일 에픽
        template: "**에픽 구조 결정**: {{epic_decision}} 근거와 함께"

  - id: epic-details
    title: "에픽 1: {{enhancement_title}}"
    instruction: |
      기존 기능을 유지하면서 브라운필드 개선을 제공하는 포괄적 에픽

      브라운필드를 위한 중요한 스토리 순서:
      - 스토리는 기존 기능이 온전히 유지되도록 해야 합니다
      - 각 스토리는 기존 기능이 여전히 작동하는지 검증을 포함해야 합니다
      - 스토리는 기존 시스템에 대한 위험을 최소화하도록 순서를 정해야 합니다
      - 각 스토리에 대한 롤백 고려사항을 포함하세요
      - 빅뱅 변경보다는 점진적 통합에 초점을 맞추세요
      - 기존 코드베이스 맥락에서 AI 에이전트 실행을 위한 스토리 크기 조정
      - 필수: 완전한 스토리 순서를 제시하고 다음을 질문하세요: "이 스토리 순서는 기존 시스템에 대한 위험을 최소화하도록 설계되었습니다. 이 순서가 프로젝트의 아키텍처와 제약사항을 고려할 때 합리적입니까?"
      - 스토리는 명확히 식별된 의존성과 함께 논리적으로 순차적이어야 합니다
      - 각 스토리는 시스템 무결성을 유지하면서 가치를 제공해야 합니다
    template: |
      **에픽 목표**: {{epic_goal}}

      **통합 요구사항**: {{integration_requirements}}
    sections:
      - id: story
        title: "스토리 1.{{story_number}} {{story_title}}"
        repeatable: true
        template: |
          {{user_type}}로서,
          {{action}}을 원하고,
          {{benefit}}를 얻기 위해서입니다.
        sections:
          - id: acceptance-criteria
            title: 수락 기준
            type: numbered-list
            instruction: 새로운 기능과 기존 시스템 무결성을 모두 포함하는 기준을 정의
            item_template: "{{criterion_number}}: {{criteria}}"
          - id: integration-verification
            title: 통합 검증
            instruction: 기존 기능이 온전히 유지되는지 확인하는 구체적 검증 단계
            type: numbered-list
            prefix: IV
            items:
              - template: "IV1: {{existing_functionality_verification}}"
              - template: "IV2: {{integration_point_verification}}"
              - template: "IV3: {{performance_impact_verification}}"
